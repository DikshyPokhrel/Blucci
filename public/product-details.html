<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product Details</title>
  <link rel="stylesheet" href="css/index.css" />
  <link rel="stylesheet" href="css/products.css" />
  <style>
    .product-details {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .product-details div {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    button#addToCartBtn,
    button#addToWishlistBtn {
      background-color: #333;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-right: 10px;
      min-width: 140px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }
    button#addToCartBtn:hover,
    button#addToWishlistBtn:hover {
      background-color: #555;
    }
    #suggestions {
      margin: 40px auto 60px;
      max-width: 1200px;
      padding: 0 20px;
    }
    #suggestions h2 {
      font-size: 1.8rem;
      margin-bottom: 20px;
      text-align: center;
    }
    #suggestions .suggestions-scroll {
      display: flex;
      overflow-x: auto;
      gap: 20px;
      padding-bottom: 10px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: #ccc transparent;
    }
    #suggestions .suggestions-scroll::-webkit-scrollbar {
      height: 8px;
    }
    #suggestions .suggestions-scroll::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 4px;
    }
    #suggestions .suggestion-item {
      flex: 0 0 auto;
      width: 180px;
      cursor: pointer;
      text-align: center;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      background: #fff;
      transition: box-shadow 0.3s ease, transform 0.3s ease, border-color 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #suggestions .suggestion-item:hover {
      box-shadow: 0 4px 15px rgba(139, 0, 0, 0.5);
      border-color: darkred;
      transform: scale(1.05);
    }
    #suggestions img {
      max-width: 100%;
      border-radius: 6px;
      margin-bottom: 8px;
      transition: transform 0.3s ease;
    }
    #suggestions .suggestion-item:hover img {
      transform: scale(1.05);
    }
    #suggestions .suggestion-name {
      font-weight: 600;
      font-size: 1rem;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body class="product-details-page">
  <main class="room-container">
    <h1 class="room-section-title" id="productName">Product Name</h1>
    <div class="product-details">
      <img id="productImage" src="" alt="" class="room-product-image" style="max-width: 400px; margin-bottom: 20px;" />
      <div>
        <button id="addToCartBtn"> Add to Cart</button>
        <button id="addToWishlistBtn"> Add to Wishlist</button>
      </div>
    </div>
  </main>

  <section id="suggestions">
    <h2>You might also like</h2>
    <div class="suggestions-scroll" id="suggestionsGrid"></div>
  </section>

  <footer>
    <div class="footer-container">
      <div class="newsletter">
        <h3>Special Offers For Subscribers</h3>
        <p>The Latest From Blucci</p>
        <form>
          <input type="email" placeholder="Email" required />
          <button type="submit">Submit</button>
          <small>By continuing, you accept the privacy policy</small>
        </form>
      </div>
      <div class="about">
        <h3>About Us</h3>
        <p>Our outlets are always changing - you will find a whole new selection each week and a new treasure hunt each visit! If you see something you love, you’d better grab it before someone else does!</p>
      </div>
      <div class="links">
        <h3>Quick Links</h3>
        <ul>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Store Locations</a></li>
          <li><a href="#">Careers</a></li>
          <li><a href="#">Terms & Conditions</a></li>
        </ul>
      </div>
      <div class="contact">
        <h3>Contact Us</h3>
        <p>info@blucci.com<br>972 293 6644</p>
        <p>
          Mon - Fri: 10AM - 7PM<br>
          Sat: 10AM - 6PM<br>
          Sun: Closed
        </p>
      </div>
      <div class="social">
        <h3>Social Feeds</h3>
        <ul>
          <li><a href="#"><i class="fab fa-facebook-f"></i> Facebook</a></li>
          <li><a href="#"><i class="fab fa-instagram"></i> Instagram</a></li>
        </ul>
      </div>
      <div class="footer-bottom">
        <p>Copyright © 2025 Blucci. All Right Reserved</p>
      </div>
    </div>
  </footer>

  <script src="js/products.js"></script>
  <script>
    function saveToStorage(key, product) {
      let stored = localStorage.getItem(key);
      let list = stored ? JSON.parse(stored) : [];
      if (!list.some(item => item.image === product.image)) {
        list.push(product);
        localStorage.setItem(key, JSON.stringify(list));
      }
    }

    async function showProductDetails() {
      const params = new URLSearchParams(window.location.search);
      const image = params.get('image');
      const name = params.get('name');

      if (name) document.getElementById('productName').textContent = name;
      if (image) {
        const imgEl = document.getElementById('productImage');
        imgEl.src = `/Images/living-room/${encodeURIComponent(image)}`;
        imgEl.alt = name || 'Product Image';
      }

      const addToCartBtn = document.getElementById('addToCartBtn');
      if (addToCartBtn) addToCartBtn.addEventListener('click', () => {
        saveToStorage('cartItems', { image, name });
        window.location.href = 'cart.html';
      });

      const addToWishlistBtn = document.getElementById('addToWishlistBtn');
      if (addToWishlistBtn) addToWishlistBtn.addEventListener('click', () => {
        saveToStorage('wishlistItems', { image, name });
        window.location.href = 'wishlist.html';
      });

      await loadSuggestions(image);
    }

    async function loadSuggestions(currentImage) {
      try {
        const response = await fetch('/api/livingroom-products');
        if (!response.ok) throw new Error('Failed to fetch suggestions');
        const products = await response.json();

        const filtered = products.filter(img => img !== currentImage);

        for (let i = filtered.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [filtered[i], filtered[j]] = [filtered[j], filtered[i]];
        }

        const suggestions = filtered.slice(0, 3);

        const suggestionsGrid = document.getElementById('suggestionsGrid');
        suggestionsGrid.innerHTML = '';

        suggestions.forEach(img => {
          const name = img.replace(/[-_]/g, ' ').replace(/\.[^/.]+$/, '');
          const item = document.createElement('div');
          item.className = 'suggestion-item';
          item.title = name;
          item.innerHTML = `
            <img src="/Images/living-room/${encodeURIComponent(img)}" alt="${name}" />
            <div class="suggestion-name">${name}</div>
          `;
          item.addEventListener('click', () => {
            const url = new URL(window.location.origin + '/product-details.html');
            url.searchParams.set('image', img);
            url.searchParams.set('name', name);
            window.location.href = url.toString();
          });
          suggestionsGrid.appendChild(item);
        });
      } catch (error) {
        console.error(error);
      }
    }

    document.addEventListener('DOMContentLoaded', showProductDetails);
  </script>
</body>
</html>
